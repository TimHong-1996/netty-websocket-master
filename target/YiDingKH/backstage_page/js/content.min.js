function $childNode(o){return window.frames[o]}function animationHover(o,e){o=$(o),o.hover(function(){o.addClass("animated "+e)},function(){window.setTimeout(function(){o.removeClass("animated "+e)},2e3)})}function WinMove(){var o="[class*=col]",e=".ibox-title",i="[class*=col]";$(o).sortable({handle:e,connectWith:i,tolerance:"pointer",forcePlaceholderSize:!0,opacity:.8}).disableSelection()}var $parentNode=window.parent.document;if($(".tooltip-demo").tooltip({selector:"[data-toggle=tooltip]",container:"body"}),$(".modal").appendTo("body"),$("[data-toggle=popover]").popover(),$(".collapse-link").click(function(){var o=$(this).closest("div.ibox"),e=$(this).find("i"),i=o.find("div.ibox-content");i.slideToggle(200),e.toggleClass("fa-chevron-up").toggleClass("fa-chevron-down"),o.toggleClass("").toggleClass("border-bottom"),setTimeout(function(){o.resize(),o.find("[id^=map-]").resize()},50)}),$(".close-link").click(function(){var o=$(this).closest("div.ibox");o.remove()}),top==this){var gohome='<div class="gohome"><a class="animated bounceInUp" href="index.html?v=4.0" title="返回首页"><i class="fa fa-home"></i></a></div>';$("body").append(gohome)}


var page=1;
$(function () {
    getManagerList();

    $('#page').on('click','a',function () {
        page=$(this).attr('data-id');
        getManagerList();
    });
    $("#apply").click(function () {
        if($('#managerName').val().length==0 & $('#managerPhone').val().length==0){
            parent.layer.msg("用户名和手机号用于登录，不能同时为空");
            return false;
        }
        if($('#password1').val().length<6||$('#password1').val().length>8){
            parent.layer.msg("请填写6到8位的密码");
            return false;
        }
        if($('#password1').val()!=$('#password2').val()){
            parent.layer.msg("两次密码不一致");
            return false;
        }
        $.ajax({
            url:getRootPath()+"/backstage/insertManager",
            data:$('#add_manager').serialize(),
            type: 'POST',
            async: false,
            dataType: 'json',
            success:function(data){
                if(data.code==2000){
                    parent.layer.msg("保存成功",{icon:1});
                    setTimeout(function () {
                        var index=parent.layer.confirm('是否继续添加账户',{
                            btn:['是','否'] //按钮
                        },function () {
                            parent.layer.close(index);
                            document.add_manager.reset();//清理表单缓存
                        },function () {
                            parent.layer.close(index);
                            setTimeout(function () {
                                $('.layui-tab-title li').removeClass('layui-this');
                                $('.layui-tab-title li[data-id=0]').addClass('layui-this');
                                $('.layui-tab-item').removeClass('layui-show');
                                $('#set0').addClass('layui-show');
                                page=1;
                                getManagerList();

                            },1000);
                        });
                    },1000);
                    return false;
                }else {
                    parent.layer.msg(data.message);
                }
            }
        })
    });
    $("#reset").click(function () {
        document.add_manager.reset();//清理表单缓存
    });
    $('.layui-tab-title').on('click','li',function () {
        var i=$(this).attr('data-id');
        $('.layui-tab-title li').removeClass('layui-this');
        $(this).addClass('layui-this');
        $('.layui-tab-item').removeClass('layui-show');
        $('#set'+i).addClass('layui-show');
        if(i==0){
            page=1;
            getManagerList();
        }
    })
});
//列表加载
function getManagerList() {
    $.ajax({
        type:'POST',
        url:getRootPath()+'/backstage/selectManagerByPage',
        data:{page:page,size:10},
        async:false,
        dataType:'json',
        success:function(data){
            if(data.code==2000){
                var sor=data.data;
                var list=data.data.list;
                var res='';
                for(var i=0;i<list.length;i++){
                    res+='<tr><td><input type="checkbox" name="" lay-skin="primary" data-id="'+list[i].managerId+'"></td>' +
                        '<td class="hidden-xs">'+list[i].managerId+'</td><td class="hidden-xs">'+list[i].managerName+'</td>' +
                        '<td>'+list[i].managerPhone+'</td>' +
                        '<td class="hidden-xs">'+(list[i].managerPower==0?"超级管理员":"管理员")+'</td><td class="hidden-xs">'+list[i].managerCreatTime+'</td>' +
                        '<td><button class="layui-btn layui-btn-mini layui-btn-normal">正常</button></td><td><div class="layui-inline">' +
                        // '<a class="layui-btn layui-btn-small layui-btn-normal go-btn" data-id="'+list[i].newsId+'" data-url="article-detail.html" tab-id="4" data-text="文章修改"><i class="layui-icon">&#xe642;</i></a>' +
                        '<a class="layui-btn layui-btn-small layui-btn-danger del-btn" data-id="'+list[i].managerId+'"><i class="layui-icon">&#xe640;</i></a>' +
                        '</div></td></tr>'
                }
                $(".content").html(res);
                var ret='';
                if(sor.page==1){
                    ret+='<li class="disabled"><a href="javascript:void(0);" data-id="1"><span><<</span></a></li>' +
                        '<li class="disabled"><a href="javascript:void(0);" data-id="1"><span><</span></a></li>'
                }else {
                    ret+='<li><a href="javascript:void(0);" data-id="1"><span><<</span></a></li>' +
                        '<li><a href="javascript:void(0);" data-id="'+(parseInt(sor.page)-1)+'"><span><</span></a></li>'
                }
                if(sor.maxPage<=5){
                    for(var k=1;k<=sor.maxPage;k++){
                        if(k==sor.page){
                            ret+='<li class="active"><span>'+k+'</span></li>'
                        }else {
                            ret+='<li><a href="javascript:void(0);" data-id="'+k+'">'+k+'</a></li>'
                        }
                    }
                }else {
                    if(sor.page<=3){
                        for(var k=1;k<5;k++){
                            if(k==sor.page){
                                ret+='<li class="active" ><span>'+k+'</span></li>'
                            }else {
                                ret+='<li><a href="javascript:void(0);" data-id="'+k+'">'+k+'</a></li>'
                            }
                        }
                        ret+='<li><span>…</span></li>'
                    }else if(sor.page>3 && sor.page<(parseInt(sor.maxPage)-2)){
                        ret+='<li><span>…</span></li>';
                        for(var k=0;k<3;k++){
                            if(k==1){
                                ret+='<li class="active"><span>'+sor.page+'</span></li>'
                            }else {
                                ret+='<li><a href="javascript:void(0);" data-id="'+(parseInt(sor.page)+k-1)+'">'+(parseInt(sor.page)+k-1)+'</a></li>'
                            }
                        }
                        ret+='<li><span>…</span></li>';
                    }else {
                        ret+='<li><span>…</span></li>';
                        for(var k=parseInt(sor.maxPage)-3;k<=sor.maxPage;k++){
                            if(k==sor.page){
                                ret+='<li class="active"><span>'+sor.page+'</span></li>'
                            }else {
                                ret+='<li><a href="javascript:void(0);" data-id="'+k+'">'+k+'</a></li>'
                            }
                        }
                    }
                }
                if(sor.page==sor.maxPage){
                    ret+='<li class="disabled"><a href="javascript:void(0);" data-id="'+sor.maxPage+'"><span>></span></a></li>' +
                        '<li class="disabled"><a href="javascript:void(0);" data-id="'+sor.maxPage+'"><span>>></span></a></li>'
                }else {
                    ret+='<li><a href="javascript:void(0);" data-id="'+(parseInt(sor.page)+1)+'"><span>></span></a></li>' +
                        '<li><a href="javascript:void(0);" data-id="'+sor.maxPage+'"><span>>></span></a></li>'
                }
                $("#page").html(ret);
                $('.del-btn').click(function () {
                    var id=$(this).attr('data-id');
                    parent.layer.confirm('是否要删除该账户？', {
                        btn: ['是','否'] //按钮
                    }, function(){
                        $.ajax({
                            type:'POST',
                            url:getRootPath()+'/backstage/deleteManager',
                            data:{managerId:id,managerDisplay:0},
                            async:false,
                            dataType:'json',
                            success:function(data){
                                if(data.code==2000){
                                    parent.layer.msg("删除成功",{icon:1});
                                    setTimeout(function () {
                                        getManagerList();
                                    },1000)
                                }else {
                                    parent.layer.msg("系统繁忙，请稍后再试");
                                }
                            }
                        })
                    },function(){});
                });
            }else if(data.code==3010){
                $(".content").html("<tr><td style='text-align: center;' colspan='8'><img style='margin: 1em;' src='../../static/admin/images/no_date.png'><p style='font-size: 24px;color: #484848;'>暂无资料</p></td></tr>");
                $("#page").html('');
            }
        }
    });
    layui.use(['form'], function() {
        var form = layui.form();
        //全选
        form.on('checkbox(allChoose)', function(data) {
            var child = $(data.elem).parents('table').find('tbody input[type="checkbox"]');
            child.each(function(index, item) {
                item.checked = data.elem.checked;
            });
            form.render('checkbox');
        });
        //渲染表单
        form.render();
    });
}